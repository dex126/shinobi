# shinobi
[![Maintainability](https://api.codeclimate.com/v1/badges/7fe6ca6c13394fb6b7db/maintainability)](https://codeclimate.com/github/dex126/shinobi/maintainability) [![contributions welcome](https://img.shields.io/badge/contributions-welcome-brightgreen.svg?style=flat)](https://github.com/dwyl/esta/issues)


### О проекте

Простой парсер информации с xlsx таблицы. Создан как Open-Source проект в качестве портфолио и в последствии демонстрации в колледже.

### Задумка

В качестве локального API используется **Sanic**. Развертывается сервер и создает `CronTrigger` на каждое Воскресенье, который вызывает функцию `download_from_url`. Можно принудительно обновить файл расписания методом `/start`, который вызывается при запуске сервера. Эксель-таблица хранится в корневой папке проекта.

В телеграм-части для парсинга расписания всех групп, используется FastAPI. При развертывании рекомендую написать свой сервис, поскольку на данный момент внутренняя часть `shinobi_api` находится в бете.

### Из фишек
Из всего проекта можно выделить развертывание локального веб-сервера для удобного обновления одного из важных компонентов [xlsx файл]. В Telegram части мы решили не заморачиваться с добавлением mongo-db и тем более sql-подобных баз данных, поступив гораздо проще, и использовав Redis в качесте основной датабазы и для states в том числе.

Модуль users отвечает за работу с базой данных. У юзера есть только два значения: `is_pinned: bool` и `group: str | None`, которые используются для предотвращения повторного закрепления сообщения в чате с юзером и вывода расписания под указанную группу соответственно. Для вытягивания этой информации в user_info парсим список в dataclass.

Как итог - получаем короткое взаимодействие с БД и крайне стабильную, быструю работу.

В проекте используется `logger`` от **loguru** для более приятной работы с терминалом.

Развертывание стандартное, через **docker**. Проекты зависят от указанной в `docker-compose.yml` сети.

### Развертывание

1. Пробросить файл расписания, либо достать его автоматически через `webserver`.
2. Заполнить .env в корневой папке проекта, а так-же в папке **excel**. Все примеры указаны в `.env.example`.

-   Для дебага на локальной машине достаточно запустить `start.py` (telegram entrypoint) и `sanic start_server:app` (sanic webserver) в корневой папке проекта.

Деплой проекта в продакшн производится через Docker:
-   `docker-compose -f deploy/docker-compose.yml up -d --build` - запускает весь проект, включая excel, webserver и telegram.

---
with soul, by @dex126 & @Georgy | 2024